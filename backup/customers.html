{% extends 'base.html' %}
{% block content %}
<style>
        /* Updated CSS for better design */
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
    padding: 0;
    
        }
        
        #main-container {
            display: flex;
            height: 100vh;
            padding: 20px;
            gap: 20px;
            box-sizing: border-box;
            height: calc(100vh - 185px);
        }
        
        #left-section, #right-section {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            height: 100%; /* Height adjusted to account for padding */
    overflow-y: auto;
            
        }
        
        #left-section {
            flex: 2;
            overflow-y: auto;
            padding: 20px;
            
        }
        
        #right-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            
        }
        
        #new-company-form, #company-list {
            margin-bottom: 20px;
        }
        
        #company-list ul, #company-projects ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        
        #company-list li, #company-projects li {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .company-link, .project-link {
            text-decoration: none;
            color: #007BFF;
            
            cursor: pointer;
        }
        
        .company-link:hover, .project-link:hover {
            text-decoration: none;  /* Keep underline removed */
            color: #0056b3; /* Slightly darken the hover color */
            text-shadow: 0 0 5px rgba(0, 123, 255, 0.3); /* Light glow on hover */
            transition: text-shadow 0.3s ease-in-out;
            
        }
        
        .delete-company, .delete-project {
            background-color: transparent;
            border: none;
            color: #dc3545;
            
            cursor: pointer;
        }
        
        .delete-company:hover, .delete-project:hover {
            color: #dc3545; /* Keep the delete color */
            text-decoration: none; /* Remove underline */
            box-shadow: 0 0 8px rgba(220, 53, 69, 0.5); /* Add a soft red glow around the text */
            transition: box-shadow 0.3s ease-in-out; /* Smooth transition for glow effect */
        }
        
        input[type="text"] {
            width: auto; /* Allow the input box to shrink */
            padding: 8px;
            margin: 0; /* Remove default margins */
            box-sizing: border-box;
            flex: 1; /* Allow the input to take available space */
        }
        
        input[type="submit"] {
            background-color: #007BFF;
            color: white;
            border: none;
            padding: 8px 8px; /* Reduced padding for a smaller button */
            cursor: pointer;
            border-radius: 4px;
            height: 36px; /* Ensures consistent height with the input box */
            line-height: 18px; /* Adjust line height to center text */
            display: inline-block; /* Ensure it's inline with the input box */
        }
        
        input[type="submit"]:hover {
            background-color: #0056b3;
        }
        
        /* Adjust scrolling behavior */
        #left-section, #right-section {
            overflow-y: auto;
        }
        
        h2, h3 {
            color: #333;
        }
        
        </style>
        
</style>

<div id="main-container">
    <!-- Left Section -->
    <div id="left-section">
        <h2 id="company-name">Select a company</h2>
        <div id="company-projects">
            <!-- Projects and images will be loaded here -->
        </div>
    </div>

    <!-- Right Section -->
    <div id="right-section">
        <!-- New Company Form -->
        <div id="new-company-form">
            <h3>Create New Company</h3>
            <form method="post">
                <label>Company Name:</label>
                <input type="text" name="company_name" required>
                <input type="submit" value="Create">
            </form>
        </div>
        <!-- Company List -->
        <div id="company-list">
            <h2>Companies</h2>
            <ul>
                {% for company in companies %}
                <li>
                    <a href="#" class="company-link" data-company="{{ company }}">{{ company }}</a>
                    <button class="delete-company" data-company="{{ company }}">Delete</button>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

<script>
// Page-specific JavaScript
document.addEventListener('DOMContentLoaded', function() {
    const companyLinks = document.querySelectorAll('.company-link');
    companyLinks.forEach(function(link) {
        link.addEventListener('click', function(event) {
            event.preventDefault();
            const companyName = this.getAttribute('data-company');
            loadCompanyData(companyName);
        });
    });

    // Function to load company data
    function loadCompanyData(companyName) {
        // Update the company name in the left section
        document.getElementById('company-name').textContent = companyName;

        // Fetch the rendered project.html via AJAX
        fetch('{{ url_for("get_company_data") }}?company_name=' + encodeURIComponent(companyName))
        .then(response => response.text())
        .then(html => {
            const projectsDiv = document.getElementById('company-projects');
            projectsDiv.innerHTML = html; // Insert the HTML content
            // Reattach event listeners for the new content
            attachProjectEventListeners();
        })
        .catch(error => {
            console.error('Error fetching company data:', error);
        });
    }

    // Function to attach event listeners to dynamically loaded content
    function attachProjectEventListeners() {
        // Handle delete project
        document.querySelectorAll('.delete-project').forEach(function(button) {
            button.addEventListener('click', function(event) {
                const projectName = this.getAttribute('data-project');
                const companyName = this.getAttribute('data-company');
                if (confirm('Are you sure you want to delete project ' + projectName + '?')) {
                    fetch('{{ url_for("delete_project") }}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ company_name: companyName, project_name: projectName })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Reload the company data to update the project list
                            loadCompanyData(companyName);
                        } else {
                            alert('Failed to delete project.');
                        }
                    });
                }
            });
        });
        

        // Handle 'Create New Project' form submission
        const newProjectForm = document.getElementById('new-project-form');
        if (newProjectForm) {
            newProjectForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const formData = new FormData(newProjectForm);
                const projectName = formData.get('project_name');
                const companyName = document.getElementById('company-name').textContent;

                fetch('{{ url_for("create_project") }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ company_name: companyName, project_name: projectName })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Reload the company data to update the project list
                        loadCompanyData(companyName);
                    } else {
                        alert('Failed to create project.');
                    }
                });
            });
        }

        // Handle click on a project to redirect to another app
        document.querySelectorAll('.project-link').forEach(function(link) {
            link.addEventListener('click', function(event) {
                event.preventDefault();
                const projectName = this.getAttribute('data-project');
                const companyName = this.getAttribute('data-company');
                // Construct the URL to the other app
                const otherAppUrl = 'http://otherapp.com/?company_name=' + encodeURIComponent(companyName) + '&project_name=' + encodeURIComponent(projectName);
                // Redirect to the other app
                window.location.href = otherAppUrl;
            });
        });
    }

    // Handle delete company
    document.querySelectorAll('.delete-company').forEach(function(button) {
        button.addEventListener('click', function(event) {
            const companyName = this.getAttribute('data-company');
            if (confirm('Are you sure you want to delete company ' + companyName + '?')) {
                fetch('{{ url_for("delete_company") }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ company_name: companyName })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Remove the company from the list
                        this.parentElement.remove();
                        // Clear the left section if the deleted company was selected
                        const selectedCompanyName = document.getElementById('company-name').textContent;
                        if (selectedCompanyName === companyName) {
                            document.getElementById('company-name').textContent = 'Select a company';
                            document.getElementById('company-projects').innerHTML = '';
                        }
                    } else {
                        alert('Failed to delete company.');
                    }
                });
            }
        });
    });
});
</script>
{% endblock %}
